<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>廣福寺 法要予約フォーム</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 15px; background-color: #f8f9fa; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 20px; }
        h2 { border-left: 5px solid #8e44ad; padding-left: 10px; color: #4a148c; font-size: 1.1em; margin-top: 0; }
        label { display: block; margin: 15px 0 5px; font-weight: bold; font-size: 0.9em; }
        input[type="text"], select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .btn-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .btn-group input[type="radio"], .btn-group input[type="checkbox"] { display: none; }
        .btn-group label { padding: 10px 12px; background: #f0f0f0; border-radius: 6px; cursor: pointer; flex: 1; text-align: center; margin: 0; font-size: 0.85em; transition: 0.2s; border: 1px solid #ddd; }
        .btn-group input:checked + label { background: #8e44ad; color: white; border-color: #8e44ad; }
        .houji-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; background: #fef7ff; padding: 10px; border-radius: 8px; }
        .hidden { display: none; }
        .hint-box { background: #fffde7; border-left: 5px solid #fbc02d; padding: 15px; margin-top: 15px; font-size: 0.85em; border-radius: 0 8px 8px 0; }
        .info-section { font-size: 0.85em; color: #555; background: #fff; padding: 15px; border-radius: 10px; border: 1px solid #eee; margin-bottom: 20px; }
        .submit-btn { display: block; width: 100%; padding: 18px; background: #06C755; color: white; text-align: center; border-radius: 50px; font-weight: bold; font-size: 1.1em; margin: 20px 0; border: none; cursor: pointer; box-shadow: 0 4px 10px rgba(6,199,85,0.3); }
        .submit-btn:disabled { background: #ccc; box-shadow: none; cursor: not-allowed; }
    </style>
</head>
<body>

<div id="app-container">
    <div class="card">
        <h2>基本情報</h2>
        <label>屋号（カタカナ）</label>
        <input type="text" id="yago">
        <label>名前</label>
        <input type="text" id="name">
        <label>お住まいの地域</label>
        <div class="btn-group">
            <input type="radio" name="area" id="a1" value="小安"><label for="a1">小安</label>
            <input type="radio" name="area" id="a2" value="釜谷"><label for="a2">釜谷</label>
            <input type="radio" name="area" id="a3" value="汐首"><label for="a3">汐首</label>
            <input type="radio" name="area" id="a4" value="瀬田来"><label for="a4">瀬田来</label>
            <input type="radio" name="area" id="a5" value="函館"><label for="a5">函館</label>
            <input type="radio" name="area" id="a6" value="その他"><label for="a6">その他</label>
        </div>
        <label>連絡先</label>
        <input type="text" id="tel">
    </div>

    <div class="card">
        <h2>1. 法要の内容</h2>
        <div class="btn-group">
            <input type="radio" name="type" id="t1" value="初七日・四十九日など" onclick="toggleHouji(false)"><label for="t1">初七日・四十九日など</label>
            <input type="radio" name="type" id="t2" value="法事" onclick="toggleHouji(true)"><label for="t2">法事</label>
        </div>
        <div id="houji-options" class="hidden">
            <label>供養の対象（3組まで入力可）</label>
            <div class="houji-row">
                <select class="kaiki"><option value="">○回忌を選択</option><option>1</option><option>3</option><option>7</option><option>13</option><option>17</option><option>23</option><option>27</option><option>33</option><option>37</option><option>50</option></select>
                <select class="ninzu"><option value="">故人の人数</option><option>1</option><option>2</option><option>3</option><option>0</option></select>名
            </div>
            <div class="houji-row">
                <select class="kaiki"><option value="">○回忌を選択</option><option>1</option><option>3</option><option>7</option><option>13</option><option>17</option><option>23</option><option>27</option><option>33</option><option>37</option><option>50</option></select>
                <select class="ninzu"><option value="">故人の人数</option><option>1</option><option>2</option><option>3</option><option>0</option></select>名
            </div>
            <div class="houji-row">
                <select class="kaiki"><option value="">○回忌を選択</option><option>1</option><option>3</option><option>7</option><option>13</option><option>17</option><option>23</option><option>27</option><option>33</option><option>37</option><option>50</option></select>
                <select class="ninzu"><option value="">故人の人数</option><option>1</option><option>2</option><option>3</option><option>0</option></select>名
            </div>
        </div>
    </div>

    <div class="card">
        <h2>2. 希望の場所</h2>
        <div class="btn-group">
            <input type="radio" name="place" id="p1" value="家族葬ホール" onclick="togglePlace(false)"><label for="p1">家族葬ホール</label>
            <input type="radio" name="place" id="p2" value="自宅" onclick="togglePlace(false)"><label for="p2">自宅</label>
            <input type="radio" name="place" id="p3" value="その他" onclick="togglePlace(true)"><label for="p3">その他</label>
        </div>
        <div id="place-other" class="hidden" style="margin-top:10px;"><input type="text" id="place-detail" placeholder="場所を入力してください"></div>
    </div>

    <div class="card">
        <h2>3. 会食（お斎）の希望</h2>
        <div class="btn-group">
            <input type="radio" name="food" id="f1" value="お弁当を注文したい（旬花）"><label for="f1">お弁当注文（旬花）</label>
            <input type="radio" name="food" id="f2" value="場所のみ利用したい（持込）"><label for="f2">場所のみ利用</label>
            <input type="radio" name="food" id="f3" value="会食なし"><label for="f3">会食なし</label>
        </div>
    </div>

    <div class="card">
        <h2>4. お供え物（供物）の準備</h2>
        <div class="btn-group">
            <input type="radio" name="kumotsu" id="k1" value="お寺にお任せ" onclick="toggleKumotsu(false)"><label for="k1">お寺にお任せ</label>
            <input type="radio" name="kumotsu" id="k2" value="自分たちで用意" onclick="toggleKumotsu(true)"><label for="k2">自分たちで用意</label>
        </div>
        <div id="kumotsu-hint" class="hint-box hidden">
            <strong>■ お供えのヒント</strong>
            <ul style="padding-left:18px; margin:5px 0;">
                <li>お花(1対)・果物・積み団子(1対)</li>
                <li>お供え餅・霊供膳（各1つで可）</li>
                <li>お菓子（個包装のもの）</li>
            </ul>
            <strong>■ 地域特有（下海岸文化）</strong>
            <ul style="padding-left:18px; margin:5px 0;">
                <li>さん餅・べこ餅・鯨餅・麦饅頭など</li>
            </ul>
        </div>
    </div>

    <div class="card">
        <h2>5. その他オプション</h2>
        <div class="btn-group">
            <input type="checkbox" name="opt" id="o1" value="塔婆を頼む"><label for="o1">塔婆を頼む</label>
            <input type="checkbox" name="opt" id="o2" value="事前に会場を見学したい"><label for="o2">会場見学希望</label>
            <input type="checkbox" name="opt" id="o3" value="引き物の相談をしたい"><label for="o3">引き物相談</label>
        </div>
    </div>

    <div class="card">
        <label>希望の日時（第3希望まで）</label>
        <textarea id="dates" rows="3"></textarea>
        <button id="main-submit" class="submit-btn" onclick="sendToLine()" disabled>LINEで送信する</button>
    </div>

    <div class="info-section">
        <h3>■ 当日の持ち物・安心ポイント</h3>
        <ul style="padding-left:18px;">
            <li>お位牌・過去帳・数珠・ご遺影（任意）</li>
            <li>供物料（お寺に依頼した場合）</li>
            <li>お寺の使用料はかかりません</li>
        </ul>
    </div>
</div>

<script>
    // --- 更新された LIFF ID ---
    const LIFF_ID = "2009136092-pOckem17";

    window.onload = function() {
        liff.init({ liffId: LIFF_ID })
            .then(() => {
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    document.getElementById('main-submit').disabled = false;
                }
            })
            .catch((err) => {
                console.error("LIFF初期化失敗", err);
                alert("LINEアプリ内で開いてください");
            });
    };

    function toggleHouji(show) { document.getElementById('houji-options').classList.toggle('hidden', !show); }
    function togglePlace(show) { document.getElementById('place-other').classList.toggle('hidden', !show); }
    function toggleKumotsu(show) { document.getElementById('kumotsu-hint').classList.toggle('hidden', !show); }

    function sendToLine() {
        const yago = document.getElementById('yago').value;
        const name = document.getElementById('name').value;
        const area = document.querySelector('input[name="area"]:checked')?.value || "未選択";
        const type = document.querySelector('input[name="type"]:checked')?.value || "未選択";
        const place = document.querySelector('input[name="place"]:checked')?.value || "未選択";
        const placeDetail = document.getElementById('place-detail').value;
        const food = document.querySelector('input[name="food"]:checked')?.value || "未選択";
        const kumotsu = document.querySelector('input[name="kumotsu"]:checked')?.value || "未選択";
        const dates = document.getElementById('dates').value;
        const tel = document.getElementById('tel').value;
        const opts = Array.from(document.querySelectorAll('input[name="opt"]:checked')).map(el => el.value).join(', ');

        let message = `【法要予約】\n屋号：${yago}\n名前：${name}\n地域：${area}\n連絡：${tel}\n内容：${type}`;
        if(type === "法事") {
            const rows = document.querySelectorAll('.houji-row');
            rows.forEach(row => {
                const k = row.querySelector('.kaiki').value;
                const n = row.querySelector('.ninzu').value;
                if(k && n) message += `\n ・${k}回忌：${n}名`;
            });
        }
        message += `\n場所：${place === "その他" ? placeDetail : place}`;
        message += `\n会食：${food}\n供物：${kumotsu}`;
        if(opts) message += `\nオプション：${opts}`;
        message += `\n\n希望日時：\n${dates}`;

        liff.sendMessages([{ type: 'text', text: message }])
            .then(() => {
                alert("送信が完了しました。");
                liff.closeWindow(); 
            })
            .catch((err) => {
                console.error("送信エラー", err);
                alert("送信に失敗しました。公式LINEのトーク画面から開き直してください。");
            });
    }
</script>
</body>
</html>
